# ‚öΩ Goal
This showcase provides a complete walkthrough of TAS-Forge‚Äôs workflow through a hands-on example. It demonstrates the end-to-end process of generating Time-Aware Shaper (TAS) schedules using the Worst-Case Delay (WCD) scheduling framework.

It demonstrates the complete process of generating TAS schedules using the **Worst-Case Delay (WCD)** scheduling framework on a network topology consisting of **5 switches**, **5 sources**, and **4 sinks**.

The showcase highlights each major phase: 
- Automatic generation of the network topology and time-sensitive streams
- Formulation of TAS scheduling constraints considering time synchronization
- Solving the scheduling problem using CPLEX
- Generation of Gate Control Lists (GCLs)
- Preparation of simulation files for OMNeT++

This example highlights how TAS-Forge simplifies TAS schedule creation, allowing users to generate, validate, and analyze time-sensitive network schedules efficiently.

This guide demonstrates how to replicate the showcased example using TAS-Forge.

# ü™ú Step-by-Step Showcase: Creating TAS Schedules with TAS-Forge
This showcase follows the step-by-step walkthrough as detailed in the [User Guide](../../documentation/User_Guide.md). 

## üíª Step 1: Configure the Network Topology
- Open MATLAB and navigate to the TAS-Forge project folder.
- Run the following script:
  <pre>
  generate_network_system  
  </pre>
- Enter the number of üî∫**sources**, üü¢ **sinks** & üü¶ **switches** in the input text box as shown below:
  
![Input Prompt](images/input_prompt.png)

- A network topology will be automatically generated, similar to the one displayed as shown below:

![Network Topology](images/network_topology.png)

- The script also generates a set of **source-to-sink** routes:
<pre>
Source to Sink Pairs:
source5 ---> sink1
source2 ---> sink2
source5 ---> sink3
source2 ---> sink4
source1 ---> sink4
source3 ---> sink2
source4 ---> sink1
</pre>

- The `generate_network_system.m` script also generates `.csv` files containing information relevant to:
    - **Node clock drift information** (`node_data.csv`) for time synchronization modeling
    - **Network parameters** (`network_data.csv`) such as, link speeds, propagation delays, hyperperiod, etc.
    - **Stream definitions and properties** (`stream_data.csv`) such as, stream ids, routes, periodicity, payload size, deadlines
- Upon sucessful creation, the following messages will appear in the MATLAB command window.
<pre>
Node output file "node_data.csv" has been created.
Network output file "network_data.csv" has been created.
Stream output file "stream_data.csv" has been created.
Port connections output file "port_connections.csv" has been created.  
</pre> 
- The script also creates the `CPLEX_Code_Output` folder containing the `.mod` files for all supported scheduling frameworks. The MATLAB command window will display: 
<pre>
Directory created for storing CPLEX codes.
Output file "output_CPLEX_code_generator_WCD.mod" has been generated in the CPLEX_Code_Output folder.
Output file "output_CPLEX_code_generator_NCD.mod" has been generated in the CPLEX_Code_Output folder.
Output file "output_CPLEX_code_generator_WCA.mod" has been generated in the CPLEX_Code_Output folder.
Output file "output_CPLEX_code_generator_NCA.mod" has been generated in the CPLEX_Code_Output folder.  
</pre>
- An empty text file `input_cplex_solution.txt` is also generated to enter the outputs from IBM CPLEX as explained in **Step 2**. The MATLAB command window will output. 
<pre>
Empty text file to input solution generated by CPLEX has been created.
</pre>

## üèóÔ∏è Step 2: Solve TAS Schedule using IBM CPLEX
- From the `CPLEX_Code_Output` folder select the `output_CPLEX_code_generator_WCD.mod` file. 
- Launch CPLEX Optimization Study, and after creating an OLP project, run the `.mod` file.
- Once executed, the **decison variables** (similar as shown) outputs are generated in the **Solutions** tab in CPLEX studio.
<pre>
lambda_1 = 663.2;
lambda_2 = 1198.2;
lambda_3 = 1733.2;
lambda_4 = 1733.2;
lambda_5 = 1733.2;
lambda_6 = 2268.2;
lambda_7 = 2268.2;
OFF_1_source5 = 0;
OFF_1_switch3 = 535;
OFF_2_source4 = 4967;
OFF_2_switch2 = 5502;
OFF_2_switch3 = 6037;
OFF_3_source5 = 11004;
OFF_3_switch3 = 11539;
OFF_3_switch4 = 12074;
OFF_3_switch5 = 12609;
OFF_4_source2 = 28394;
OFF_4_switch1 = 28929;
OFF_4_switch2 = 29464;
OFF_4_switch3 = 29999;
OFF_5_source1 = 7892;
OFF_5_switch1 = 8427;
OFF_5_switch2 = 8962;
OFF_5_switch3 = 9497;
OFF_6_source2 = 7390;
OFF_6_switch1 = 7925;
OFF_6_switch2 = 8460;
OFF_6_switch3 = 8995;
OFF_6_switch4 = 9530;
OFF_7_source3 = 6888;
OFF_7_switch1 = 7423;
OFF_7_switch2 = 7958;
OFF_7_switch3 = 8493;
OFF_7_switch4 = 9028;
</pre>
- Select the **offset** decision variables (those in the format `OFF_<streamID>_<deviceName>`) and paste them in the `input_cplex_solutions.txt` file.
- üî• **Important**:
    - The `lambda` variables (e.g., lambda_1, lambda_2, etc.) are not required by TAS-Forge, but can be copied and left without issues.
    - Ensure that **all** offset variables are copied in the format shown above: `OFF_<streamID>_<deviceName> = <value>;` Otherwise, the next step will fail due to missing inputs.
    - **Do not** paste the CPLEX standard solution log (which summarizes the quality of solution found) in the text file. 
      
## üóíÔ∏è Step 3: Create Gate Control Lists (GCLs)
- To generate GCLs, run the following script to generate GCLs:
<pre>
generate_GCL_output  
</pre>

- Select the scheduler type when prompted. For this example, *WCD* need to be entered.
- Note: If you entered another scheduler type, it is ok, re-run the script. 
- The script will:
    - Create corresponding GCLs in the `output_GCL_matrix.txt`.
    - The **schedulability cost** metric is also displayed in the MATLAB command window.
<pre>
generate_GCL_output
What scheduler did you select (WCA/WCD/NCA/NCD)?:  WCD
File "output_GCL_matrix.txt" has been created.

The schedulability cost is 0.025  
</pre>

## üè≠ Step 4: Generate Simulation Configuration
- To generate the `.ned` and `.ini` files, run the following script:
<pre>
generate_omnetpp_files  
</pre>
- The script will create `OMNETpp_Code_Output` directory for storing the generated files.
- The `.ned` will be generated, along with a figure denoting all network devices and the traffic flow directions based on the topology (similar to the one shown below).
- If the `output_GCL_matrix.txt` file is read sucessfully, the script will also generate the corresponding `.ini` file containing the simulation configuration.
- Both files are necessary to run the TAS-Forge simulation inside OMNeT++.

![Network Topology NED](images/network_topology_ned.png)

MATLAB command window output is shown below, displaying successful `.ned` and `.ini` file generation:
<pre>
generate_omnetpp_files
OMNETpp_Code_Output directory has been created.
NED file generated_topology.ned generated successfully in directory OMNETpp_Code_Output.
File "output_GCL_matrix.txt" read successfully
INI file simulation_config_WCD.ini generated successfully in directory OMNETpp_Code_Output.
</pre>

## üî¨ Step 5: Analyzing Simulation Results
- Import the `.ned` and `.ini` generated from Step 4 for loading in OMNeT++.
- Run the simulation for a default period of 1 second. 
- After the simulation completes, navigate to generated `.vec` result file.
- Filter the results based on selecting entries labeled `meanBitLifeTimePerPacket:vector`, which represents the end-to-end latency for each frame (as shown below).
![Mean-bit-lifetime](images/omnetpp_min_e2e_latency.png)
- Export the results as a `.csv` file and name it `results.csv`.
- Transfer the `.csv` file to your MATLAB workspace with TAS-Forge.
- Run the following command in your MATLAB command window:
<pre>
 analyze_omnet_results 
</pre> 
- This should create a `stream_data_output.csv` file and the following prompt will be displayed:
<pre>
Results saved to stream_data_output.csv
Results updated to stream_data_output.csv  
</pre>
- The output `.csv` file should provide a summary of the streams including the analytical and meaured end-to-end latencies, jitter, routes, etc.
- The measured end-to-end latencies fall within the boundaries of the analytical end-to-end latencies.
- For further details on interpreting the results refer to the [Technical Overview](../../documentation/Technical_Overview.md) page. 

# ‚úÖ Summary
This showcase demonstrated the use of TAS-Forge workflow using the WCD method:
- Topology and stream generation.
- Scheduling using CPLEX.
- GCL creation.
- OMNeT++ simulation.
- Result analysis for the WCD method.
