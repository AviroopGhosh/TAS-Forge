# User Guide
This guide provides a step-by-step walkthrough for using TAS-Forge — from setting up the software environment to generating schedules, running simulations, and analyzing results.

Before getting started, please ensure that all required tools (MATLAB, IBM CPLEX, and OMNeT++) are properly installed and configured, along with any necessary dependencies. For details on supported versions and setup instructions, refer to the [Prerequisites](#prerequisites) section below.

For a deeper understanding of the tool's design, functionality, and scheduling model, see the [Technical Overview](Technical_Overview.md) documentation.

To review current limitations and known issues encoutered in the tool, refer to the [Known Issues and Limitations](Issues_and_Limitations.md) page.

## [Prerequisites](#prerequisites)
For implementing TAS-Forge, it is vital that the following software tools are installed correct and configured:

### 1. MATLAB
- Required for: Topology generation, CPLEX and OMNeT++ code generation, TAS schedule creation, and performance analysis from simulation outputs.
- Recommended Version: R2021b or later.
- Tip: Ensure MATLAB is added to your system’s environment PATH if you intend to run it from the terminal.

### 2. IBM CPLEX
- Required for: Solving TAS scheduling frameworks formulated as Integer Linear Programs (ILPs).
- Recommended Version: CPLEX Optimization Studio 22.1.1 or later.
- Installation Steps:
    - Download from the official [IBM CPLEX Download Page](https://www.ibm.com/support/pages/downloading-ibm-ilog-cplex-optimization-studio-2211).
- Note:
    - You may need to create an IBM account to access the download.
    - CPLEX must be run via the IBM GUI, as MATLAB integration is not supported in newer versions (22.x and beyond).

### 3. OMNeT++ 
- Required for: Simulating the generated network topology and validate the TAS schedule execution.
- Recommended Version: OMNeT++ 6.0.1 or newer.
- Dependencies: Requires INET version 4.4.
- Installation Steps:
    - Download OMNeT++ from the [OMNeT++ Download Page](https://omnetpp.org/download/).
    - Download INET from the [INET Download Page](https://inet.omnetpp.org/2022-05-16-INET-4.4.0-released.html).
- Note:
    - The .ned and .ini files generated by TAS-Forge should be imported in an OMNeT++ project for simulation. 

### 4. TAS-Forge Repository
To get the project code:

<pre> git clone https://github.com/AviroopGhosh/TAS-Forge.git </pre>

Or you can download it as a ZIP file and extract it. 

## [Folder Structure](#folder_structure)

<pre>
    TAS-Forge/
    ├── function_generate_routes.m         % Function to generate pair of sources and sinks to form routes
    ├── function_generate_topology_map.m   % Function used to generate the topology map incl. source and destination ports
    ├── function_import_topology_data.m    % This funcition is used to import the topology-related data  
    ├── generate_CPLEX_code_NCA.m          % Generate CPLEX input files based on Network-Derived Clock Drift Adustment (NCD) scheduling framework
    ├── generate_CPLEX_code_NCD.m          % Generate CPLEX input files based on Network-Derived Clock Drift Delay (NCD) scheduling framework
    ├── generate_CPLEX_code_WCA.m          % Generate CPLEX input files based on Worst-case Adjustment (WCA) scheduling framework
    ├── generate_CPLEX_code_WCD.m          % Generate CPLEX input files based on Worst-case Delay (WCD) scheduling framework
    ├── generate_GCL_output.m              % Generate Gate Control Lists (GCLs) based on the scheduling framework selected    
    ├── generate_network_system.m          % Starting script used to generate the network topology, routes and stream parameters
    ├── generate_omntepp_files.m           % Generates both NED and INI files for OMNeT++ simulation
    ├── generate_omnetpp_ini_file.m        % This script generates the INI file for simulation
    ├── generate_omnetpp_ned_file.m        % This script generates the NED file to load into OMNeT++ 
    ├── input_cplex_solution.txt           % Text file to paste solution generated by CPLEX
    ├── network_data.csv                   % Generated network data for scheduling (created by running generate_network_systems.m)
    ├── node_data.csv                      % Records clock drift values for nodes (created by running generate_network_systems.m)
    ├── output_GCL_matrix.txt              % Output of GCLs of all relevant egress ports (created by running generate_GCL_output.m)
    ├── port_connections.csv               % Port connection list of all devices to neighbouring nodes (created by running generate_network_systems.m)
    ├── stream_data.csv                    % Lists stream parameters incl. routes, periodicity, etc. (created by running generate_network_systems.m)
    ├── CPLEX_Code_Output/                 % Directory for all CPLEX model output files (created by running generate_network_systems.m)
        ├── output_CPLEX_code_NCA.mod      % CPLEX input file for NCA scheduling method (created by running generate_CPLEX_code_NCA.m)          
        ├── output_CPLEX_code_NCD.mod      % CPLEX input file for NCD scheduling method (created by running generate_CPLEX_code_NCD.m)  
        ├── output_CPLEX_code_WCA.mod      % CPLEX input file for WCA scheduling method (created by running generate_CPLEX_code_WCA.m)  
        ├── output_CPLEX_code_WCD.mod      % CPLEX input file for WCD scheduling method (created by running generate_CPLEX_code_WCD.m) 
    ├── OMNETpp_Code_Output/               % Directory containing the ini and ned files (created by running generate_omnetpp_files.m)
        ├── generated_topology.ned         % Ned file generated
        ├── simulation_config_<>.ini       % Ini file generated based on scheduler type  
</pre>

## Step-by-Step Guide: Using TAS-Forge
This section provides a step-by-step guide for using TAS-Forge. Before beginning, ensure that all the required files are present in your MATLAB working directory. To understand how the files are organized, refer to the [Folder Structure](#folder_structure) section. 

**Note:** Many files (e.g., CSV exports, CPLEX input, OMNeT simulation files) are generated during execution. These files will not appear until their corresponding scripts have been run. This will be highlighted in the respective steps. 

### Step 1: Generate Network Topology and Stream Parameters
To being using TAS-Forge, run the following script in MATLAB:

<pre>
    generate_network_system
</pre>

The script will prompt the user to input:
- Number of sources
- Number of sinks
- Number of switches

Once provided, the script will automatically create the following:
- A linear network topology consisting of the network devices with a visually representative figure
- A set of routes connecting each source to at least one or more sink nodes
- Set of streams per route with the following properties:
    - Payload size
    - Transmission Periodicity
    - Deadline constraint

**Note:** Each source must be connected to at least one sink. Isolated devices (sources or sinks with no valid route) are not supported. If this occurs, the script will prompt a re-run with adjusted device settings.
For more details, see the [Known Issues and Limitations](documentation/Issues_and_Limitations.md) page. 

The script exports the following files:
- `stream_data.csv` - Contains configuration parameters for each time-sensitive stream, including payload, periodicity, and deadlines.
- `network_data.csv` - Stores global network parameters such as hyperperiod, macroticks, synchronization periodicity etc. 
- `node_data.csv` - Lists the clock drift values assigned to each network node, used for the time synchronization and TAS scheduling process. 
- `port_connections.csv`- Contains information about each egress port in the network, including its connected neighboring device and the list of streams routed.

The script also executes all the following scripts. Each script generates a CPLEX-compatible text file containing the integer linear programming formulation for TAS schedule computation:
- `generate_CPLEX_code_NCA.m` - Generates CPLEX input file based on the NCA scheduling method 
- `generate_CPLEX_code_NCD.m` - Generates CPLEX input file based on the NCD scheduling method
- `generate_CPLEX_code_WCA.m` - Generates CPLEX input file based on the WCA scheduling method
- `generate_CPLEX_code_WCD.m` - Generates CPLEX input file based on the WCD scheduling method

The `generate_network_systems.m` script automatically creates a directory `CPLEX_Code_Output/`, and the corresponding CPLEX model (.mod) files are generated:
- `output_CPLEX_code_NCA.mod`
- `output_CPLEX_code_NCD.mod`
- `output_CPLEX_code_WCA.mod`
- `output_CPLEX_code_WCD.mod`

Finally, a blank text file `input_cplex_solution.txt` is created. This file is used to manually paste the GCL offset values (the decision variables) obtained after solving the CPLEX model. This is explained in Step 2.

### Step 2: Execute CPLEX Code
This step is a manual process, as MATLAB does not currently support integration with the required version of IBM CPLEX. 

Using the CPLEX model files generated in the previous step, select one of the scheduling frameworks (e.g., NCA, NCD, WCA and WCD) and run it using IBM CPLEX Optimization Studio. 

**Important:** Before proceeding, ensure that **CPLEX is properly installed and configured.**

To execute the model file:
- Launch CPLEX Optimization Studio and create a new OPL Project.
- Add the corresponding '.mod' file generated in the 'CPLEX_Code_Output/' folder generated by TAS-Forge.
- Create a Run Configuration within the OPL project for the `.mod`.
- Run the model to compute the TAS schedule.




